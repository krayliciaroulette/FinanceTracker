@{
    ViewData["Title"] = "Dashboard Analytics";
    var categories = ViewBag.CategoryData as IEnumerable<dynamic>;
}

<h2 class="text-light">Dashboard Analytics</h2>
<div class="text-center mt-4 mb-4">
    <a asp-action="MonthlyReport" class="btn btn-info btn-lg shadow-sm">
        📊 View Monthly Report
    </a>
</div>

<div class="row mb-4 text-light">
    <div class="col-md-4">
        <div class="card bg-dark p-3">
            <h4>Total Budgets</h4>
            <p class="fs-4 fw-bold text-success">₱@ViewBag.TotalBudgets</p>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card bg-dark p-3">
            <h4>Total Expenses</h4>
            <p class="fs-4 fw-bold text-danger">₱@ViewBag.TotalExpenses</p>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card bg-dark p-3">
            <h4>Remaining Balance</h4>
            <p class="fs-4 fw-bold @(ViewBag.Remaining < 0 ? "text-danger" : "text-info")">₱@ViewBag.Remaining</p>
        </div>
    </div>
</div>

<h4 class="text-light mt-5">Expense Breakdown by Category</h4>
<canvas id="expenseChart" width="400" height="200"></canvas>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById('expenseChart');
        const chart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: @Html.Raw(Json.Serialize(categories.Select(c => c.Category))),
                datasets: [{
                    data: @Html.Raw(Json.Serialize(categories.Select(c => c.Total))),
                    backgroundColor: [
                        '#00bcd4', '#ff9800', '#4caf50', '#f44336', '#9c27b0', '#3f51b5'
                    ],
                }]
            },
            options: {
                plugins: {
                    legend: { labels: { color: '#ffffff' } }
                }
            }
        });
    </script>
}
